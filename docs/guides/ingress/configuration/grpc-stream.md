---
title: Enable HTTP/2
menu:
  product_voyager_8.0.1:
    identifier: enable-http-2
    name: Enable HTTP/2
    parent: Enable HTTP/2
    weight: 10
product_name: voyager
menu_name: product_voyager_8.0.1
section_menu_id: guides
---
> New to Voyager? Please start [here](/docs/concepts/overview.md).

# Enable HTTP/2

You can configure HTTP/2.0 by configuring `proto` or, `alpn` under `rules.http` section (for frontend) or, `backend` section (for specific backend). If you want to use only `HTTP/2.0`, then you can specify it using `proto: h2`. However, if you like to use both `HTTP/2.0` and `HTTP/1.1` in a preferred order, then you need to specify the order using `ALPN`.

Please note the followings:
- TLS needed to be configured for using `ALPN`.
- A single rule/backend can't use both `ALPN` and `proto`.
- Multiple rules pointing the same frontend can't use different `ALPN` or, `proto` configurations.

## Example: gRPC Stream

First create demo namespace for this example.

```
$ kubectl create namespace demo
namespace/demo created
```

### Deploy gRPC Test Server

```yaml
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    run: test-server
  name: test-server
  namespace: demo
spec:
  selector:
    matchLabels:
      run: test-server
  template:
    metadata:
      labels:
        run: test-server
    spec:
      containers:
      - image: diptadas/haproxy-grpc-sample-server:1.3
        name: test-server
        imagePullPolicy: Always
---
apiVersion: v1
kind: Service
metadata:
  labels:
    run: test-server
  name: test-server
  namespace: demo
spec:
  ports:
  - port: 3000
    targetPort: 3000
    name: grpc
  selector:
    run: test-server
```

### Create Ingress

```yaml
apiVersion: voyager.appscode.com/v1beta1
kind: Ingress
metadata:
  name: test-ingress
  namespace: demo
spec:
  rules:
  - host: "*"
    http:
      port: 3001
      proto: h2
      paths:
      - path: /
        backend:
          serviceName: test-server
          servicePort: 3000
          proto: h2
```

### Generated haproxy.cfg

```ini
# HAProxy configuration generated by https://github.com/appscode/voyager
# DO NOT EDIT!
global
  daemon
  stats socket /var/run/haproxy.sock level admin expose-fd listeners
  server-state-file global
  server-state-base /var/state/haproxy/
  # log using a syslog socket
  log /dev/log local0 info
  tune.ssl.default-dh-param 2048
  ssl-default-bind-ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!3DES:!MD5:!PSK
  lua-load /etc/auth-request.lua
defaults
  log global
  # https://cbonte.github.io/haproxy-dconv/1.7/configuration.html#4.2-option%20abortonclose
  # https://github.com/appscode/voyager/pull/403
  option dontlognull
  option http-server-close
  option http-use-htx
  # Timeout values
  timeout client 50s
  timeout client-fin 50s
  timeout connect 50s
  timeout server 50s
  timeout tunnel 50s
  # Configure error files
  # default traffic mode is http
  # mode is overwritten in case of tcp services
  mode http
frontend http-0_0_0_0-3001
  bind *:3001  proto h2
  mode http
  option httplog
  option forwardfor
  acl is_proxy_https hdr(X-Forwarded-Proto) https
  acl is_proxy_https ssl_fc
  http-request set-var(req.scheme) str(https) if is_proxy_https
  http-request set-var(req.scheme) str(http) if ! is_proxy_https
  acl acl_: path_beg /
  use_backend test-server.demo:3000 if  acl_:
backend test-server.demo:3000
  server pod-test-server-bd758cd57-2sj2f 172.17.0.6:3000        proto h2
```

### Check Response

```console
$ minikube service --url voyager-test-ingress -n demo
http://192.168.99.100:30003
```

Run a gRPC client using docker.

```
$ docker run -it diptadas/haproxy-grpc-sample-client:1.3 --address=192.168.99.100:30003
2019/02/05 04:58:42 192.168.99.100:30003 
Generating codenames...
2019/02/05 04:58:42 Received: Curious Warthog
2019/02/05 04:58:43 Received: Languid Giraffe
2019/02/05 04:58:44 Received: Mighty Shark
2019/02/05 04:58:45 Received: Mighty Heron
2019/02/05 04:58:46 Received: Sleepy Vulture
2019/02/05 04:58:47 Received: Languid Lizard
```

You will see a stream of random names.

### Cleanup

```
$ kubectl delete ns demo
namespace "demo" deleted
```

## Reference

- https://www.haproxy.com/blog/haproxy-1-9-2-adds-grpc-support
- https://github.com/appscode/haproxy-grpc-sample/tree/x1

